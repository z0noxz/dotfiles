#!/bin/sh

# check if running in X
inx=$([ ! -z $XAUTHORITY ] && echo 1 || echo 0)

case $inx in
1)
    pgrep -x dmenu && exit

    lumi="$(readvtc 0 | lumi)"
    args="
        -fn "hack:size=9"                                                   \
        -nb $([ "$lumi" -gt 50 ] && printf '#fdfdfd' || printf '#030303')   \
        -nf $(readvtc 6)                                                   \
        -sb $(readvtc 5)                                                   \
        -sf $(readvtc 6)"

    while :; do
        case "$1" in
        -b | -f | -i)
            args="$args $1";;
        -l | -h | -m | -p | -fn | -nb | -nf | -sb | -sf)
            args="$args $1"; shift; args="$args $1";;
        -w)
            args="$args $1"; shift; args="$args $(eval echo $1)";;
        --)
            shift; break;;
        -*)
            echo "invalid option: $1" 1>&2; exit 1;;
        *)
            break;;
        esac
        shift
    done

    dmenu${args}
;;
0)
    # fix for 'cascading' fzfs
    sleep 0.01

    fzf-tmux                                                                \
        --reverse                                                           \
        --select-1                                                          \
        --exit-0
;;
esac
